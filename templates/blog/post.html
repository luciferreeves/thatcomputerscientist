{% extends 'blog/partials/base.html' %} {% block content %}

<div id="article">
    <img src="{% url 'ignis:post_image' '730' post.id %}.gif" alt="Cover Image" style="width: 730px; margin: 0 auto; display: block;">
    <h1>{{ post.title }}</h1>
    <p style="line-height: 1.6em;">
        Posted on <em><u>{{ post.date | date:"M d, Y" }}</u></em> by <em><a href="#">{{ post.author }}</a> in <a href="#">{{ post.category }}</a></em>
    </p>
    <p>Tags:
        {% for tag in tags %}
            <a href="#" class="tag">{{ tag.name }}</a>
        {% endfor %}
    </p>
    <hr>
    <div id="article-body">{{ post.body | safe }}</div>
</div>

<div id="comments" style="clear: both;" class="mtsbitem">
    <h2>Comments</h2>
    {% for comment in comments %}
        <div id="comment-{{ comment.id }}">
            <table>
                <tr>
                    <td style="width: 60px; vertical-align: top;">
                        <img src="{{ comment.avatar_url }}" alt="Profile Picture" style="width: 50px; height: auto;">
                    </td>
                    <td style="vertical-align: top;">
                        <p style="margin-top: 0;">
                            <a href="#">{{ comment.user.username }}</a> on <em>{{ comment.created_at | date:"M d, Y" }}</em>
                            {% if comment.edited %}
                                <em>(Edited)</em>
                            {% endif %}
                            {% if comment.user == user %}
                                &nbsp;&nbsp;
                                <a href="javascript:;" onclick="editComment({{ comment.id }})">Edit</a>
                                &nbsp;&nbsp;
                                <a href="{% url 'blog:delete_comment' post.slug comment.id %}" onclick="return confirm('Are you sure you want to delete this comment?')">Delete</a>
                            {% endif %}
                        </p>
                        <p>
                            <span id="comment-body-{{ comment.id }}">{{ comment.body }}</span>
                            <form action="{% url 'blog:edit_comment' post.slug %}" method="POST" id="edit-form-{{ comment.id }}" style="display: none;">
                                {% csrf_token %}
                                <input type = "hidden" name="comment_id" value="{{ comment.id }}">
                                <textarea name="body" id="body" cols="78" rows="10" style="width: 640px; display: block; margin-bottom: 10px;">{{ comment.body }}</textarea>
                                <input type="submit" value="Update" class="button button-special">
                                <input type="button" value="Cancel" onclick="cancelEdit({{ comment.id }})" class="button">
                            </form>
                        </p>
                    </td>
                </tr>
            </table>
        </div>
    {% endfor %}
</div>

{% if user.is_authenticated %}
<div id="new-comment" class="mtsbitem">
    <h2>Leave a Comment</h2>
    <form action="{% url 'blog:comment' post.slug %}" method="POST">
        {% csrf_token %}
        <textarea name="body" id="body" cols="88" rows="10" style="width: 710px; display: block; margin-bottom: 15px;" placeholder="Your comment here..."></textarea>
        <input type="submit" value="Submit" class="button button-special">
    </form>
</div>
{% else %}
<div id="new-comment" class="mtsbitem">
    <h2>Leave a Comment</h2>
    <p>You must be logged in to leave a comment. <a href="{% url 'blog:login' %}">Login</a> or <a href="{% url 'blog:register' %}">Register</a>.</p>
</div>
{% endif %}

<script>
    function editComment(id) {
        document.getElementById('comment-body-' + id).style.display = 'none';
        document.getElementById('edit-form-' + id).style.display = 'block';
    }

    function cancelEdit(id) {
        document.getElementById('comment-body-' + id).style.display = 'block';
        document.getElementById('edit-form-' + id).style.display = 'none';
    }
</script>
{% endblock %}
