{% extends 'blog/partials/base.html' %} {% block content %}
<div class="main">
  <article>
    <h1 style="margin-bottom: 12px; font-size: 2rem;">{{ post.title }}</h1>
    <p style="line-height: 1.6em;">
        Posted on <em><u>{{ post.date | date:"M d, Y" }}</u></em> by <em><a href="#">{{ post.author }}</a> in <a href="#">{{ post.category }}</a></em>
        <br>
        <b>Tags:</b>
        {% for tag in tags %}
            <a href="#" class="tag">{{ tag.name }}</a>
        {% endfor %}
    </p>
    
    <hr>
    <div class="article-body">{{ post.body | safe }}</div>
    <div id="comments" style="margin-top: 3rem;">
        <h3>Comments</h3>
        {% for comment in comments %}
            <div class="comment">
                <div class="profile-picture">
                    <img src="https://www.gravatar.com/avatar/{{ comment.avatar }}?s=100" alt="Profile Picture">
                </div>
                <div>
                    <p class="comment-header">
                        <a href="#">{{ comment.user.username }}</a> on <em>{{ comment.created_at | date:"M d, Y" }}</em>
                        {% if comment.edited %}
                            <em>(Edited)</em>
                        {% endif %}
                        {% if comment.user == user %}
                            &nbsp;&nbsp;•&nbsp;&nbsp;
                            <a href="javascript:;" onclick="editComment({{ comment.id }})">Edit</a>
                            &nbsp;&nbsp;•&nbsp;&nbsp;
                            <a href="{% url 'blog:delete_comment' post.slug comment.id %}" onclick="return confirm('Are you sure you want to delete this comment?')">Delete</a>
                        {% endif %}
                    </p>
                    <p class="comment-body">
                        <span id="comment-body-{{ comment.id }}">{{ comment.body }}</span>
                        <form action="{% url 'blog:edit_comment' post.slug %}" method="POST" id="edit-form-{{ comment.id }}" style="display: none;">
                            {% csrf_token %}
                            <input type = "hidden" name="comment_id" value="{{ comment.id }}">
                            <textarea name="body" id="body" cols="30" rows="10">{{ comment.body }}</textarea>
                            <input type="submit" value="Update" style="display:inline-block;">
                            <input type="button" value="Cancel" onclick="cancelEdit({{ comment.id }})" style="display:inline-block;">
                        </form>
                    </p>
                </div>
            </div>
        {% endfor %}
        {% if user.is_authenticated %}
        <form action="{% url 'blog:comment' post.slug %}" method="post">
            {% csrf_token %}
            <div class="form-group">
                <label for="comment">Add Comment:</label>
                <textarea name="comment" id="comment" class="form-control" rows="5"></textarea>
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>
        </form>
        {% else %}
            <p><em>You must be logged in to comment.</em></p>
        {% endif %}
    </div>
</article>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script>
    function editComment(id) {
        document.getElementById('comment-body-' + id).style.display = 'none';
        document.getElementById('edit-form-' + id).style.display = 'block';
    }

    function cancelEdit(id) {
        document.getElementById('comment-body-' + id).style.display = 'block';
        document.getElementById('edit-form-' + id).style.display = 'none';
    }
    </script>
</div>
{% endblock %}
