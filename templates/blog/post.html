{% extends 'blog/partials/base.html' %} {% block content %}
{% load static %}
{% load tz %}
<div id="post-actions-bar" class="mtsbitem">
    <a class="pa-btn" href="{% url 'blog:home' %}">Home</a>
    <a class="pa-btn" href="#comments">Opinions</a>
    {% comment %} <a class="pa-btn" id="translate-jp" href="javascript:;">
        <img src="{% static 'images/icons/translate.png' %}" alt="Translate to Japanese" style="height: 11px; width: 11px; margin-right: 5px; position: relative; top: 1px;">
        {% if request.session.language == 'jp' %}
            Translate to English
        {% else %}
            Translate to Japanese
        {% endif %}
    </a> {% endcomment %}
</div>
<div id="article">
    <h1 style="text-align: left; color: #f4ebff;">
        {{ post.title }}
    </h1>
    <div class="author-info" style="margin-top: 0;">
        {% with post.author.userprofile_set.first as userprofile %}
            <span style="background-image: url('{% static 'images/avatars/' %}{{ userprofile.avatar_url }}.gif');" class="post-profile-image"></span>
        {% endwith %}
        <span>
            <a href="{% url 'blog:user_activity' post.author %}" style="font-weight: bold;">
                {{ post.author.first_name }} {{ post.author.last_name }}
            </a>
        </span>
        <span>posted in</span>
        <span>
            <a href="{% url 'blog:categories' %}/{{ post.category.slug }}" style="">
                {{ post.category }}
            </a>
        </span>
        <span style="margin-left: 4px;"><b>|</b></span>
        <span style="margin-left: 4px;">{% localtime on %}{{ post.date | date:"M d, Y" }}{% endlocaltime %}</span>
        <span style="margin-left: 4px;"><b>|</b></span>
        <span style="margin-left: 4px;">{{ post.views }} view{% if not post.views == 1%}s{% endif %}</span>
    </div>

    <div id="article-body">
        {{ post.first_paragraph | safe }}
        <img style="width: 100%; height: 473.3333px; margin: 20px auto; display: block; border-radius: 8px;" src="{% url 'ignis:post_image' '710' post.id %}.gif" alt="Post Image for {{ post.title }}">
        <hr>
        {{ post.body | safe }}
    </div>
</div>

<h2 class="mtsbitem">Comments
    <a href="#header" class="pa-btn" style="float: right; margin-top: 0px; text-transform: capitalize; font-weight: normal;">
        Back to Top
    </a>
</h2>
{% if comments %}
<div id="comments" style="clear: both;">
    {% for comment in comments %}
        <div id="comment-{{ comment.id }}">
            <table>
                <tr>
                    <td style="width: 60px; vertical-align: top;">
                        <img src="{% static 'images/avatars/' %}{{ comment.avatar_url }}.gif" alt="Profile Picture" style="width: 50px;">
                    </td>
                    <td style="vertical-align: top; width: 668px;">
                        <div style="margin-bottom: 13px; border-bottom: dashed 1px white; padding-bottom: 13px;">
                            <a href="{% url 'blog:user_activity' comment.user.username %}">{{ comment.user.username }}</a> on <em>{{ comment.created_at | date:"M d, Y" }}</em>
                            {% if comment.edited %}
                                <em>(Edited)</em>
                            {% endif %}
                            {% if comment.user == user %}
                                &nbsp;&nbsp;
                                <a href="javascript:;" onclick="editComment({{ comment.id }})">Edit</a>
                                &nbsp;&nbsp;
                                <a href="{% url 'blog:delete_comment' post.slug comment.id %}" onclick="return confirm('Are you sure you want to delete this comment?')">Delete</a>
                            {% endif %}
                        </div>
                        <div id="comment-body-{{ comment.id }}" class="comment">
                            {{ comment.processed_body|safe }}
                        </div>
                        {% if comment.user == user %}
                        <div id="edit-form-{{ comment.id }}" style="display: none; margin-bottom: 20px;">
                            <form action="{% url 'blog:edit_comment' post.slug %}" method="POST">
                                {% csrf_token %}
                                <input type = "hidden" name="comment_id" value="{{ comment.id }}">
                                <textarea name="body" id="body" cols="78" rows="10" style="width: 640px; display: block; margin-bottom: 10px;">{{ comment.body }}</textarea>
                                <input type="submit" value="Update" class="button button-special">
                                <input type="button" value="Cancel" onclick="cancelEdit({{ comment.id }})" class="button">
                            </form>
                        </div>
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>
    {% endfor %}
</div>
{% else %}
<div id="comments" style="clear: both;">
    <p><em>Sadly, there are no comments yet. Be the first to leave one!</em></p>
</div>
{% endif %}

{% if user.is_authenticated %}
<div id="new-comment"  class="mtsbitem">
    <h2>Leave a Comment</h2>
    <form action="{% url 'blog:comment' post.slug %}" method="POST">
        {% csrf_token %}
        <textarea name="comment" id="comment" cols="88" rows="10" style="width: 710px; display: block; margin-bottom: 15px;" placeholder="Your comment here..."></textarea>
        <div id="comment-tips" style="    /* background-color: #2d1d3d; */
        padding: 10px;
        margin-bottom: 15px;
        border-radius: 6px;
        margin-top: -10px;
        border: solid 1px white; width: calc(100% - 20px);">
            <p onclick="toggleTips()" style="cursor: pointer; margin: 0;"><span style="border-bottom: dotted 1px white;" class="noselect">Text Markup Tips &gt;</span></p>
            <div id="tips" style="display: none;">
                <p>
                    This site uses a custom built markup format for comments. It's very similar to Markdown. Only certain types of markup are allowed. Here's a list of what you can do:
                </p>

                <ul style="list-style-type: disc; margin: 0;padding: 0; margin: 5px 0px 0px 30px;">
                    <li>Wrap text in double underscores (__) to make it <i>italic</i>.
                        <br>
                        e.g. <code>__italic__</code>
                        <br><br>
                    </li>
                    <li>Wrap text in double asterisks (**) to make it <b>bold</b>.
                        <br>
                        e.g. <code>**bold**</code>
                        <br><br>
                    </li>
                    <li>Wrap text in double tildes (~~) to <s>strikethrough</s> it.
                        <br>
                        e.g. <code>~~strikethrough~~</code>
                        <br><br>
                    </li>
                    <li>Wrap text in triple backticks (<code>```</code>) to make it a code block:
                        <br>
                        e.g. 
<pre>
    ```
    code block
    ```
</pre>
                or define with language as:
<pre>
    ```lang-&lt;language&gt;
    code block
    ```
</pre> 
                        e.g. lang-python, lang-java, lang-javascript, etc.
                        <br><br><b>PS:</b> Tags for code block (<code>```</code>) must be contained on their respective individual lines. Only the language definition tag can be on the same line as the opening tag.
                        <br><br>
                    </li>
                    <li>Wrap text in double dollar sign ($$) to make it a math block and single dollar sign ($) to make it inline math. You can use LaTeX syntax.
                        <br>
                        e.g. <code>$$\frac{1}{2}$$</code> or <code>$\frac{1}{2}$</code>
                        <br><br>
                    </li>
                </ul>
                <p style="margin-top: -7px;">Any links, images or other markup will be kept as plain text. Also, free speech is good and all, but please keep it civil. Sufficient JavaScript support will be required to bind shortkeys. Please type the markup manually if you are on an older browser.</p>
            </div>
        </div>
        <input type="submit" value="Submit" class="button button-special">
    </form>
    
</div>
{% else %}
<div id="new-comment" class="mtsbitem">
    <h2>Leave a Comment</h2>
    <p><em>You must be logged in to leave a comment.</em></p>
</div>
{% endif %}
{% endblock %}
{% block scripts %}
<script type="text/javascript">
    function editComment(id) {
        document.getElementById('comment-body-' + id).style.display = 'none';
        document.getElementById('edit-form-' + id).style.display = 'block';
    }

    function cancelEdit(id) {
        document.getElementById('comment-body-' + id).style.display = 'block';
        document.getElementById('edit-form-' + id).style.display = 'none';
    }

    function toggleTips() {
        var tips = document.getElementById('tips');
        $('#tips').slideToggle('fast');
    }
</script>

{% include 'blog/partials/mathjax.html' %}
{% endblock %}

